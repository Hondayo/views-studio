<!-- uploadEpisode.ejs -->
<!-- ページ見出し: 大きくエピソード追加を明示 -->
<div class="page-header">
  <h1 class="main-title">エピソード追加ページ</h1>
  <p class="sub-info">
    ここでは作品にエピソードを追加できます。<br>
    <strong>あらすじ以外はすべて必須</strong> なのでご注意ください。
  </p>
</div>

<div class="page-container"><!-- 2カラムレイアウト -->

  <!-- === 左カラム：フォーム === -->
  <div class="episode-form">
    <!-- セクション見出しを入れてもOK -->
    <h2>新しいエピソードを追加する</h2>
    <p class="section-desc">
      動画ファイル、エピソードタイトル、時間、価格などを入力してください。<br>
      あらすじは任意です。
    </p>

    <form id="episodeForm"
          class="upload-form"
          action="/works/<%= work._id %>/episodes" 
          method="POST" 
          enctype="multipart/form-data">

      <!-- 1) 動画ファイル (必須化) -->
      <div id="mainDrop" class="drop-full">
        <div class="drop-message">
          <div class="drop-icon">⬆</div>
          <p>ここに動画ファイルをドラッグ＆ドロップ<br>またはクリックしてファイルを選択</p>
        </div>
        <!-- ★ 'required' を付与 -->
        <input type="file" id="contentFile" name="contentFile" hidden accept="video/*" required>
      </div>

      <!-- 2) 詳細入力 (最初は非表示、動画を選んだら表示) -->
      <div id="details" class="details hidden">
        <div class="ep-form">

          <!-- (必須) エピソードタイトル -->
          <div class="form-group">
            <label for="title">エピソードタイトル <span style="color: red;">*</span></label>
            <input type="text" id="title" name="title" required>
          </div>

          <!-- (任意) あらすじ -->
          <div class="form-group">
            <label for="description">あらすじ(任意)</label>
            <textarea id="description" name="description" rows="3"></textarea>
          </div>

          <!-- (必須) 動画時間 -->
          <div class="form-group" style="display: none;"><!-- 非表示 -->
            <label for="duration">動画時間（分）</label>
            <input type="number" id="duration" name="duration" min="0" placeholder="例: 24" required>
          </div>

          <!-- (必須) 価格 -->
          <div class="form-group">
            <label for="price">価格（円） <span style="color:red;">*</span></label>
            <input type="number" id="price" name="price" min="0" placeholder="0 で無料" required>
          </div>
          

        </div><!-- /.ep-form -->
      </div><!-- /#details -->

      <!-- 3) 送信ボタン -->
      <button type="submit" class="btn-primary">エピソードを保存</button>
    </form>
  </div><!-- /.episode-form -->


  <!-- === 右カラム：プレビュー === -->
  <aside class="preview-pane">
    <div class="preview-phone-frame">
      <div class="preview-phone-screen">
        
        <!-- ▼ 作品のサムネイル (前画面で決定した画像) 16:9推奨 -->
        <div class="preview-thumbnail-wrapper">
          <% if (work.thumbnailUrl) { %>
            <img 
              src="<%= work.thumbnailUrl %>" 
              alt="<%= work.title %>" 
              class="preview-thumbnail">
          <% } else { %>
            <div class="placeholder-overlay">
              作品サムネイルが未設定です
            </div>
          <% } %>
        </div>

        <div class="title-row">
          <div class="preview-title" id="previewTitle"><%= work.title %></div>
          <button type="button" id="toggleExtra" class="extra-toggle-btn">詳細</button>
        </div>

        <!-- 公開年 + レーティング + キャスト / スタジオ -->
        <dl id="previewExtra" class="preview-extra hidden">
          <dd class="year-label">
            <%= work.releaseDate && work.releaseDate.trim() !== '' 
                 ? work.releaseDate 
                 : '未設定' %>
          </dd>
          <dd class="rating-badge">
            <%= work.rating && work.rating.trim() !== ''
                 ? work.rating
                 : '未設定' %>
          </dd>
          <dt>キャスト</dt>
          <dd><%= work.cast && work.cast.trim() !== '' ? work.cast : '未設定' %></dd>
          <dt>制作</dt>
          <dd><%= work.studio && work.studio.trim() !== '' ? work.studio : '未設定' %></dd>
        </dl>

        <div class="episode-thumb" id="previewArea"></div>

        <div class="episode-info-line clamp-2" id="episodeInfoLine">
          <span id="combinedText"></span>
        </div>

        <div class="toggle-link hidden" id="toggleMore">---続きを見る---</div>

        <div class="episode-extra-line">
          <span class="episode-time" id="previewDuration">0分</span>
          <span class="episode-price" id="previewPrice">無料</span>
        </div>

      </div><!-- /.preview-phone-screen -->
    </div><!-- /.preview-phone-frame -->
  </aside><!-- /preview-pane -->

</div><!-- /.page-container -->

<!-- 既存のJSはそのまま -->
<script src="/js/uploadEpisode.js"></script>
