<!-- 編集ボタンのオーバーレイ -->
<div id="globalOverlay">
  <a id="popupEditBtn" href="/works/<%= work._id %>/edit" class="btn popup-btn">
    編集する
  </a>
</div>

<div class="viewer-page">
  <div class="viewer-container">

    <!-- デスクトップ表示領域 -->
    <div id="desktopView" class="desktop-view">
      
      <div class="work-card">
        <div class="thumbnail-wrapper">
          <img 
            src="<%= work.thumbnailUrl %>" 
            alt="<%= work.title %>" 
            class="static-image" 
          />
          <% if (work.thumbnailVideoUrl) { %>
            <video 
              src="<%= work.thumbnailVideoUrl %>"
              muted
              playsinline
              preload="metadata"
              class="hover-video hidden"
            ></video>
          <% } %>
        </div>
        
        <div class="hero-info">
          <h1 class="work-title"><%= work.title %></h1>
          <button id="toggleDetailBtn" class="btn detail-btn">詳細を見る</button>

          <div id="detailArea" class="hidden">
            <% if (work.releaseDate) { %>
              <p>公開年: <%= work.releaseDate %></p>
            <% } %>
            <% if (work.rating) { %>
              <p>レーティング: <%= work.rating %></p>
            <% } %>
            <% if (work.cast) { %>
              <p>キャスト: <%= work.cast %></p>
            <% } %>
            <% if (work.studio) { %>
              <p>制作会社: <%= work.studio %></p>
            <% } %>
          </div>
        </div>
      </div><!-- /.work-card -->

      <section class="episode-section">
        <h2>エピソード</h2>
        <a 
          href="/works/<%= work._id %>/episodes/video"
          class="btn btn-primary"
          style="margin-left: 16px;"
        >
          エピソードを追加
        </a>

        <% if (episodes && episodes.length > 0) { %>
          <% episodes.forEach((ep, i) => { %>
            <div class="episode-card">
              <div class="episode-thumb-wrapper">
                <video 
                  controls 
                  src="<%= ep.cloudinaryUrl %>" 
                  class="episode-video"
                ></video>
              </div>
              <div class="episode-info">
                <h3><%= ep.title || '無題' %></h3>
                
                <% if (ep.description) { %>
                  <p><%= ep.description %></p>
                <% } %>
                
                <% if (ep.duration) { %>
                  <p><%= ep.duration %> 分</p>
                <% } %>
                
                <% if (ep.price) { %>
                  <p><%= ep.price %> 円</p>
                <% } else { %>
                  <p>無料</p>
                <% } %>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <p>エピソードがまだありません。</p>
        <% } %>
      </section>
    </div><!-- /#desktopView -->

  </div><!-- /.viewer-container -->
</div><!-- /.viewer-page -->

<script src="/js/workDetail.js"></script>
