# データモデル概要

Views Studioは、MongoDBをデータベースとして使用し、Mongooseを通じてデータモデルを定義しています。
このドキュメントでは、システムで使用されている主要なデータモデルとその関連性について説明します。

## モデル一覧

1. [Work (作品)](./Work.js.md) - 作品の基本情報
2. [Episode (エピソード)](./Episode.js.md) - 各作品のエピソード
3. [User (ユーザー)](./User.js.md) - システムユーザー情報
4. [ShortClip (ショートクリップ)](./ShortClip.js.md) - 短編動画コンテンツ
5. [Analytics (分析)](./Analytics.js.md) - 視聴統計データ

## ERD（Entity Relationship Diagram）

以下は、主要なエンティティ間の関係を示す簡略化したERDです：

```
+---------------+       +---------------+       +---------------+
|               |       |               |       |               |
|     Work      |<------+    Episode    +------>|   Analytics   |
|               |       |               |       |               |
+-------+-------+       +-------+-------+       +---------------+
        ^                       ^
        |                       |
        |                       |
+-------+-------+       +-------+-------+
|               |       |               |
|     User      |       |  ShortClip    |
|               |       |               |
+---------------+       +---------------+
```

## モデル間の関連性

- **Work** と **Episode**: 1対多の関係。1つの作品に複数のエピソードが含まれる
- **Episode** と **Analytics**: 1対多の関係。1つのエピソードに複数の視聴データが関連付けられる
- **User** と **Work**: 多対多の関係。ユーザーは複数の作品を作成でき、作品は複数のユーザーによって閲覧される
- **ShortClip** は独立したコンテンツとして存在するが、特定の作品やエピソードに関連付けることも可能

## 共通フィールド

すべてのモデルに共通するフィールド：

- `_id`: MongoDBによって自動生成される一意のドキュメントID
- `createdAt`: ドキュメント作成日時（タイムスタンプ）
- `updatedAt`: ドキュメント更新日時（タイムスタンプ）

## インデックス

パフォーマンス向上のために設定されているインデックス：

- **Work**: `title`（検索用）、`tags`（フィルタリング用）
- **Episode**: `work`（親作品参照用）、`title`（検索用）
- **Analytics**: `episode`（関連エピソード参照用）、`date`（日付別集計用）

## バリデーション

各モデルには、データの整合性を保つためのバリデーションルールが設定されています：

- 必須フィールドのチェック
- 文字列長の制限
- 数値範囲の制限
- 日付形式の検証
- 参照整合性のチェック

詳細なバリデーションルールは、各モデルのドキュメントを参照してください。

## モデルの拡張

新しいフィールドを追加する場合は、以下の点に注意してください：

1. 既存のドキュメントとの互換性
2. デフォルト値の設定
3. 適切なバリデーションルールの追加
4. 必要に応じたインデックスの設定
5. 関連するモデルへの影響の確認

## 次のステップ

各モデルの詳細については、対応するドキュメントを参照してください：

- [Work モデル詳細](./Work.js.md)
- [Episode モデル詳細](./Episode.js.md)
- [User モデル詳細](./User.js.md)
- [ShortClip モデル詳細](./ShortClip.js.md)
- [Analytics モデル詳細](./Analytics.js.md)
